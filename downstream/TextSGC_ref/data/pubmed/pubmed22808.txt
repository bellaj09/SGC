"A CMOS-based bidirectional brain machine interface system with on-chip frequency-domain near infrared spectroscopy fdNIRS and transcranial direct-current stimulation tDCS is designed to enable noninvasive closed-loop brain stimulation for neural disorders treatment and cognitive performance enhancement. The dual channel fdNIRS can continuously monitor absolute cerebral oxygenation during the entire tDCS process by measuring NIR lights attenuation and phase shift across brain tissue. Each fdNIRS channel provides 120\xa0dB transimpedance gain at 80\xa0MHz with a power consumption of 30 mW while tolerating up to 8 pF input capacitance. A photocurrent between 10 and 450\xa0nA can be detected with a phase resolution down to 0.2. A lensless system with subnanowatt sensitivity is realized by using an avalanche photodiode. The on-chip programmable voltage-controlled resistor stimulator can support a stimulation current from 0.6 to 2.2\xa0mA with less than 1% variation which covers the required current range of tDCS. The chip is fabricated in a standard 130-nm CMOS process and occupies an area of 2.25 mm2." A CMOS-Based Bidirectional Brain Machine Interface System With Integrated fdNIRS and tDCS for Closed-Loop Brain Stimulation.